name: XMind MCP Cloud Service

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy-cloud-service:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install fastapi uvicorn openpyxl beautifulsoup4 python-docx
    
    - name: Start MCP Server
      run: |
        python xmind_mcp_server.py &
        sleep 10
        curl -f http://localhost:8080/health || exit 1
    
    - name: Deploy to Render
      if: github.ref == 'refs/heads/main'
      env:
        RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
      run: |
        # 这里可以添加部署到Render.com或其他云服务的逻辑
        echo "Deploying to cloud service..."
    
    - name: Create Service URL
      run: |
        echo "🚀 MCP Server is ready!"
        echo "API Documentation: http://localhost:8080/docs"
        echo "Health Check: http://localhost:8080/health"

  # 可选：Docker构建任务（仅在有Docker环境时运行）
  build-docker:
    runs-on: ubuntu-latest
    needs: deploy-cloud-service
    if: github.ref == 'refs/heads/main' && false  # 默认禁用，需要时改为true
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
      if: false  # 禁用Docker相关步骤
    
    - name: Build Docker Image (Optional)
      if: false  # 禁用Docker构建
      run: |
        echo "Docker构建已禁用，使用纯Python方案"
        # docker build -t xmind-mcp-server:latest .